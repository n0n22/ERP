<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="staffMapper">
	
	<!-- 사원 등록 - STAFF 테이블 -->
	<insert id="insertStaff" parameterType="staff">
		INSERT
		  INTO
		  	   STAFF
		       (
		        STAFF_NO
				,STAFF_NAME
				,JUMIN_NO
				,SCHOOL_CODE
				,DEPARTMENT_CODE
				,GRADUATE_DAY
		       )
	    VALUES
		       (
		       STAFF_SEQ.NEXTVAL
		       ,#{ staff_name }
		       ,#{ jumin_no }
		       ,(select school_code from code_school where school_name = #{ school_name })
		       ,(select department_code from code_department where department_name = #{ department_name })
		       ,#{ graduate_day }
		       )	
	</insert>
    
    <!-- 사원 등록 - STAFF-SKILL 테이블 -->
    <insert id="insertStaffSkill" parameterType="staff">
    	INSERT
    	  INTO
    	       STAFF_SKILL
		       (
		       STAFF_SKILL_NO
			   ,STAFF_NO
			   ,SKILL_CODE
		       )
			  SELECT
				       STAFF_SKILL_SEQ.NEXTVAL,
				       A.* 
				  FROM 
				       (
					    <foreach item="item" collection="skill_name" separator="UNION ALL " >
					        select 
					               (select max(staff_no) from staff)
					               ,(select skill_code from code_skill where skill_name = #{ item })
					          from 
					               dual
					    </foreach>
			   ) A
    </insert>
    
    <!-- 사원 전체 목록 개수 -->
    <select id="selectAllListCount">
    	SELECT
    	       COUNT(*)
    	  FROM
    	       STAFF
    </select>

	<!-- 사원 전체 목록 조회 -->
	<select id="selectAllList">
		select 
				STAFF_NO,
				STAFF_NAME,
				DECODE(substr(jumin_no, 8, 1), '1', '남',  '2', '여', '3', '남', '4', '여') as "JUMIN_NO",
				DEPARTMENT_NAME,
				substr(GRADUATE_DAY, 0, 4) || '-' || substr(GRADUATE_DAY, 4, 2)
				from staff S, code_department C
				where (S.department_code = C.department_code)
	</select>



</mapper>